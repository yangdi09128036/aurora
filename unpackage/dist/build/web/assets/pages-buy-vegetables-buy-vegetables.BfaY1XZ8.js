import{n as a,b as e,a as s,c as t,w as r,i as l,o as c,d as o,q as n,u as i,F as d,e as h,g as u,I as f,ae as g,S as _,x as m,t as p,af as b,j as y}from"./index-DyUMtph-.js";import{_ as k}from"./left.CpwphMH_.js";import{_ as w,a as T}from"./camera.sMgFRGYR.js";import{_ as v}from"./_plugin-vue_export-helper.BCo6x5W8.js";const D=v({data:()=>({refreshing:!1,currentTab:0,searchPlaceholder:"请输入商品信息",categories:[],currentTabData:[],allGoods:[],banners:[]}),onLoad(){this.getInitialData()},methods:{async onPullDownRefresh(){this.refreshing=!0,await this.getInitialData(),this.refreshing=!1},async getInitialData(){try{await Promise.all([this.getCategories(),this.getGoods(),this.getBanners()]),this.switchTab(0),this.allGoods.length>0&&(this.searchPlaceholder=this.allGoods[Math.floor(Math.random()*this.allGoods.length)].keywords||"请输入商品信息")}catch(a){console.error("获取数据失败:",a)}},async getCategories(){try{const{result:{data:e}}=await a.database().collection("mall-categories").get();this.categories=e||[]}catch(e){console.error("获取分类数据失败:",e)}},async getGoods(){try{const{result:{data:e}}=await a.database().collection("mall-goods").get();this.allGoods=e||[]}catch(e){console.error("获取商品数据失败:",e)}},async getBanners(){try{const{result:{data:e}}=await a.database().collection("banner").get(),s=e[0]||{};this.banners=s.banner_imgs.slice(0,6).map((a=>a.fileID||a.url))}catch(e){console.error("获取轮播图数据失败:",e)}},switchTab(a){this.currentTab=a;const e=this.categories[a];if(e)if(0===a){const a=[...this.allGoods].sort((()=>Math.random()-.5));this.currentTabData=a.slice(0,30)}else this.currentTabData=this.allGoods.filter((a=>parseInt(a.category_id)===parseInt(e.sort)))},navigateToSearch(){e({url:"/pages/search/search"})},navBack(){s({url:"/pages/index/index"})}}},[["render",function(a,e,s,v,D,x){const C=u,G=f,I=l,F=b,P=g,j=y,B=_;return c(),t(I,{class:"container"},{default:r((()=>[o(I,{class:"fixed-head"},{default:r((()=>[o(I,{class:"search-container"},{default:r((()=>[o(C,{class:"back-icon",src:k,mode:"aspectFit",onClick:x.navBack},null,8,["onClick"]),o(I,{class:"search-box",onClick:x.navigateToSearch},{default:r((()=>[o(C,{class:"search-icon",src:w,mode:"aspectFit"}),o(G,{class:"search-input",type:"text",placeholder:D.searchPlaceholder},null,8,["placeholder"]),o(C,{class:"search-icon",src:T,mode:"aspectFit"})])),_:1},8,["onClick"])])),_:1}),o(I,{class:"tab-container"},{default:r((()=>[(c(!0),n(d,null,i(D.categories,((a,e)=>(c(),t(I,{key:e,class:m(["tab-item",{active:D.currentTab===e}]),onClick:a=>x.switchTab(e)},{default:r((()=>[h(p(a.name),1)])),_:2},1032,["class","onClick"])))),128))])),_:1})])),_:1}),o(B,{"scroll-y":"","refresher-enabled":"","refresher-triggered":D.refreshing,onRefresherrefresh:x.onPullDownRefresh,class:"scroll-container"},{default:r((()=>[o(I,{class:"banner-container"},{default:r((()=>[o(P,{class:"banner-swiper","indicator-dots":"true",autoplay:"true",interval:"5000",circular:"true"},{default:r((()=>[(c(!0),n(d,null,i(D.banners,((a,e)=>(c(),t(F,{key:e},{default:r((()=>[o(C,{class:"banner-image",src:a,mode:"aspectFill"},null,8,["src"])])),_:2},1024)))),128))])),_:1})])),_:1}),o(I,{class:"content"},{default:r((()=>[null!==D.currentTab?(c(),t(I,{key:0,class:"tab-content"},{default:r((()=>[(c(!0),n(d,null,i(D.currentTabData,((a,e)=>(c(),t(I,{key:e,class:"content-item"},{default:r((()=>[o(I,{class:"product-card"},{default:r((()=>{var e;return[o(C,{class:"item-image",src:null==(e=a.goods_thumb)?void 0:e.fileID,mode:"aspectFit"},null,8,["src"]),o(I,{class:"product-info"},{default:r((()=>[o(j,{class:"item-title"},{default:r((()=>[h(p(a.name),1)])),_:2},1024),o(I,{class:"service-tags"},{default:r((()=>[o(j,{class:"tag pay-later"},{default:r((()=>[h("先用后付")])),_:1}),o(j,{class:"tag quick-refund"},{default:r((()=>[h("极速退款")])),_:1})])),_:1}),o(I,{class:"price-row"},{default:r((()=>[o(j,{class:"price"},{default:r((()=>[h("¥"+p(a.price),1)])),_:2},1024),o(j,{class:"sales"},{default:r((()=>[h("全店已拼"+p(a.total_sell_count)+"+件",1)])),_:2},1024)])),_:2},1024)])),_:2},1024)]})),_:2},1024)])),_:2},1024)))),128))])),_:1})):(c(),t(I,{key:1,class:"loading"},{default:r((()=>[h("加载中...")])),_:1}))])),_:1})])),_:1},8,["refresher-triggered","onRefresherrefresh"])])),_:1})}],["__scopeId","data-v-f81132ad"]]);export{D as default};
