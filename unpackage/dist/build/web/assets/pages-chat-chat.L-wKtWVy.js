import{a9 as s,s as e,l as t,m as a,aa as i,ab as o,ac as l,c,w as n,i as r,o as h,d,q as u,u as g,F as p,e as m,t as f,x as k,f as y,g as b,j as M,S as w,I as C,h as _}from"./index-DyUMtph-.js";import{s as I}from"./store.CDKRaDHf.js";import{_ as v}from"./_plugin-vue_export-helper.BCo6x5W8.js";const T=v({data:()=>({userInput:"",messages:[],scrollTop:0,apiKey:"Bearer sk-spmqlmgubqprspefzvbbbkbbrdjyztzmjwobteinkoenhdyv",apiUrl:"https://api.siliconflow.cn/v1/chat/completions",showHistory:!1,userInfo:{},lastQuestion:"",chatHistory:[{title:"今天",items:[]},{title:"昨天",items:[]},{title:"7天内",items:[]},{title:"30天内",items:[]}],headerTitle:"新对话",likedMessages:{},dislikedMessages:{},feedbackMessage:"",showFeedback:!1,isVoiceEnabled:!0,voiceUrl:"",isMaleVoice:!0,voiceRoleId:14}),computed:{currentVoiceRole(){return this.isMaleVoice?"/static/role-boy.png":"/static/role-girl.png"}},mounted(){this.getUserInfo(),this.loadChatHistoryFromStorage()},methods:{getUserInfo(){I.hasLogin&&(this.userInfo=I.userInfo)},toggleHistory(){this.showHistory=!this.showHistory},copyMessage(t){s({data:t,success:()=>{e({title:"复制成功",icon:"success"})}})},loadChatHistoryFromStorage(){const s=t("chatHistory");s&&(this.chatHistory=JSON.parse(s))},saveChatHistoryToStorage(){a("chatHistory",JSON.stringify(this.chatHistory))},addToHistory(s,e){const t={question:s,answer:e,timestamp:(new Date).getTime(),messages:[...this.messages]};this.chatHistory[0].items.unshift(t),this.saveChatHistoryToStorage()},loadChatHistory(s){this.messages=[...s.messages],this.showHistory=!1,this.scrollToBottom()},async sendMessage(){if(!this.userInput.trim())return;this.lastQuestion=this.userInput,this.headerTitle=this.userInput;const s={role:"user",content:this.userInput};this.messages.push(s),console.log("Messages after adding user message:",this.messages);const e=this.userInput;this.userInput="";this.messages.push({role:"assistant",content:"思考中..."}),this.$nextTick((()=>{this.scrollToBottom()}));try{const s=await i({url:this.apiUrl,method:"POST",header:{Authorization:this.apiKey,"Content-Type":"application/json"},data:{messages:[{role:"system",content:e}],model:"deepseek-ai/DeepSeek-V3"}});if(200===s.statusCode){const t=s.data.choices[0].message.content;console.log("回答的内容:",s.data),this.messages[this.messages.length-1].content=t,this.addToHistory(e,t),this.isVoiceEnabled&&this.playVoice(t)}else this.messages[this.messages.length-1].content=`请求失败，状态码: ${s.statusCode}`}catch(t){console.error("请求失败:",t),this.messages[this.messages.length-1].content="请求失败，请稍后重试"}this.$nextTick((()=>{this.scrollToBottom()}))},scrollToBottom(){o().in(this).select(".chat-content").boundingClientRect((s=>{s&&(this.scrollTop=1e6*s.height)})).exec()},startNewChat(){this.messages=[],this.lastQuestion="",this.scrollTop=0,this.headerTitle="新对话"},retryLastQuestion(){this.lastQuestion.trim()?(this.userInput=this.lastQuestion,this.sendMessage()):console.warn("没有可重试的问题")},formatMarkdown:s=>(new MarkdownIt).render(s),likeMessage(s){this.likedMessages[s]?this.$set(this.likedMessages,s,!1):(this.dislikedMessages[s]&&this.$set(this.dislikedMessages,s,!1),this.$set(this.likedMessages,s,!0),this.feedbackMessage="感谢您的反馈，我会努力做得更好！",this.showFeedback=!0,setTimeout((()=>{this.showFeedback=!1}),3e3))},dislikeMessage(s){this.dislikedMessages[s]?this.$set(this.dislikedMessages,s,!1):(this.likedMessages[s]&&this.$set(this.likedMessages,s,!1),this.$set(this.dislikedMessages,s,!0),this.feedbackMessage="感谢您的反馈，我会努力改正！",this.showFeedback=!0,setTimeout((()=>{this.showFeedback=!1}),3e3))},toggleVoice(){this.isVoiceEnabled=!this.isVoiceEnabled},toggleVoiceRole(){this.isMaleVoice=!this.isMaleVoice,this.voiceRoleId=this.isMaleVoice?14:15,this.feedbackMessage=this.isMaleVoice?"已切换为男声":"已切换为女声",this.showFeedback=!0,setTimeout((()=>{this.showFeedback=!1}),1500)},async playVoice(s){const e=`https://xiaoapi.cn/API/zs_tts.php?type=xunfei&msg=${encodeURIComponent(s)}&id=${this.voiceRoleId}`;try{const s=await i({url:e,method:"GET"});if(200===s.statusCode&&200===s.data.code){this.voiceUrl=s.data.tts;const e=l();e.src=this.voiceUrl,e.play()}else console.error("语音合成失败:",s)}catch(t){console.error("语音合成请求失败:",t)}}}},[["render",function(s,e,t,a,i,o){const l=r,I=b,v=M,T=w,V=C,H=_;return h(),c(l,{class:"container"},{default:n((()=>[d(l,{class:k(["history-sidebar",{"show-sidebar":i.showHistory}])},{default:n((()=>[d(l,{class:"history-content"},{default:n((()=>[(h(!0),u(p,null,g(i.chatHistory,((s,e)=>(h(),c(l,{class:"history-section",key:e},{default:n((()=>[d(l,{class:"history-date"},{default:n((()=>[m(f(s.title),1)])),_:2},1024),(h(!0),u(p,null,g(s.items,((s,e)=>(h(),c(l,{class:"history-item",key:e,onClick:e=>o.loadChatHistory(s)},{default:n((()=>[m(f(s.question),1)])),_:2},1032,["onClick"])))),128))])),_:2},1024)))),128))])),_:1}),d(l,{class:"user-info"},{default:n((()=>[d(I,{class:"user-avatar",src:i.userInfo.avatar_file&&i.userInfo.avatar_file.path?i.userInfo.avatar_file.path:"/static/default-avatar.png",mode:"aspectFill"},null,8,["src"]),d(v,{class:"user-phone"},{default:n((()=>[m(f(i.userInfo.mobile||"173****7441"),1)])),_:1})])),_:1})])),_:1},8,["class"]),d(l,{class:k(["main-content",{"shift-content":i.showHistory}])},{default:n((()=>[d(l,{class:"header"},{default:n((()=>[d(I,{src:"/assets/more-v1VE5ohU.png",mode:"aspectFit",class:"menu-button",onClick:o.toggleHistory},null,8,["onClick"]),d(I,{src:"/assets/launch-DaV7MX8q.png",mode:"aspectFit",class:"new-chat-button",onClick:o.startNewChat},null,8,["onClick"]),d(v,{class:"header-title"},{default:n((()=>[m(f(i.headerTitle),1)])),_:1}),d(I,{src:o.currentVoiceRole,mode:"aspectFit",class:"voice-role-button",onClick:o.toggleVoiceRole},null,8,["src","onClick"]),d(I,{src:i.isVoiceEnabled?"/static/voice.png":"/static/voice-ed.png",mode:"aspectFit",class:"voice-button",onClick:o.toggleVoice},null,8,["src","onClick"])])),_:1}),d(T,{class:"chat-content","scroll-y":"true","scroll-top":i.scrollTop,"scroll-with-animation":!0},{default:n((()=>[0===i.messages.length?(h(),c(l,{key:0,class:"welcome-screen"},{default:n((()=>[d(I,{class:"welcome-logo",src:"/assets/deepseek-BThqHkDO.png",mode:"aspectFit"}),d(l,{class:"welcome-title"},{default:n((()=>[m("嗨！我是 DeepSeek")])),_:1}),d(l,{class:"welcome-subtitle"},{default:n((()=>[m(" 我可以帮你搜索、答疑、写作，请把你的任务交给我吧~ ")])),_:1})])),_:1})):(h(),c(l,{key:1,class:"messages-container"},{default:n((()=>[(h(!0),u(p,null,g(i.messages,((s,e)=>(h(),c(l,{key:e,class:k(["message-wrapper","user"===s.role?"user-message":"ai-message"])},{default:n((()=>[d(I,{class:"avatar",src:"user"===s.role?i.userInfo.avatar_file&&i.userInfo.avatar_file.path?i.userInfo.avatar_file.path:"/static/default-avatar.png":"/static/deepseek.png",mode:"aspectFill"},null,8,["src"]),d(l,{class:"message-content"},{default:n((()=>[d(v,null,{default:n((()=>[m(f(s.content),1)])),_:2},1024),"assistant"===s.role?(h(),c(l,{key:0,class:"message-actions"},{default:n((()=>[d(I,{src:"/assets/copy-B7Ts_50S.png",mode:"aspectFit",class:"action-button",onClick:e=>o.copyMessage(s.content)},null,8,["onClick"]),d(I,{src:"/assets/refresh-D2inJRh4.png",mode:"aspectFit",onClick:o.retryLastQuestion,class:"action-button"},null,8,["onClick"]),d(I,{src:i.likedMessages[e]?"/static/thumbs-up-ed.png":"/static/thumbs-up.png",mode:"aspectFit",class:"action-button",onClick:s=>o.likeMessage(e)},null,8,["src","onClick"]),d(I,{src:i.dislikedMessages[e]?"/static/thumbs-down-ed.png":"/static/thumbs-down.png",mode:"aspectFit",class:"action-button",onClick:s=>o.dislikeMessage(e)},null,8,["src","onClick"])])),_:2},1024)):y("",!0)])),_:2},1024)])),_:2},1032,["class"])))),128))])),_:1})),i.showFeedback?(h(),c(l,{key:2,class:"feedback-toast"},{default:n((()=>[m(f(i.feedbackMessage),1)])),_:1})):y("",!0)])),_:1},8,["scroll-top"]),d(l,{class:"input-section"},{default:n((()=>[d(l,{class:"input-wrapper"},{default:n((()=>[d(V,{type:"text",modelValue:i.userInput,"onUpdate:modelValue":e[0]||(e[0]=s=>i.userInput=s),placeholder:"给 DeepSeek 发送消息","confirm-type":"send",class:"input-field",onConfirm:o.sendMessage},null,8,["modelValue","onConfirm"]),d(H,{class:k(["send-button",{"send-button-active":i.userInput.trim()}]),onClick:o.sendMessage},{default:n((()=>[m(" 发送 ")])),_:1},8,["class","onClick"])])),_:1})])),_:1})])),_:1},8,["class"])])),_:1})}],["__scopeId","data-v-740d07f9"]]);export{T as default};
